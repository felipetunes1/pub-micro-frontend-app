<app-go-home [title]="title + ' Query Connector'"></app-go-home>
<div class="container">
   <form [formGroup]="registerForm" class="form-qc-create" (submit)="submit()">
      <div class="row" *ngIf="!create">
         <div class="col-sm-12">
            <mat-form-field class="full-width">
               <mat-label>Template Code</mat-label>
               <input matInput formControlName="templateCode" />
            </mat-form-field>
         </div>
      </div>
      <div class="row">
         <div class="col-sm-6">
            <mat-form-field class="full-width">
               <mat-label>Database Name</mat-label>
               <input matInput formControlName="database" [matAutocomplete]="auto" />
               <mat-autocomplete #auto="matAutocomplete" [displayWith]="getDatabaseName"
                  (optionSelected)="database = $event.option.value">
                  <mat-option *ngFor="let database of databases" [value]="database">
                     {{database.name}}
                  </mat-option>
               </mat-autocomplete>
               <mat-error *ngIf="registerForm.controls.database.touched && registerForm.controls.database.errors">
                  <span *ngIf="registerForm.controls.database.errors.required">Database is required</span>
               </mat-error>
            </mat-form-field>
         </div>
         <div class="col-sm-6" *ngIf="!!this.database && this.database.type == 'javascript'">
            <mat-form-field class="full-width">
               <mat-label>Collection</mat-label>
               <input matInput formControlName="collection" />
            </mat-form-field>
            <mat-error *ngIf="registerForm.controls.collection.touched && registerForm.controls.collection.errors">
               <span *ngIf="registerForm.controls.collection.errors.required">Collection is required</span>
            </mat-error>
         </div>
      </div>
      <!-- <div class="row">
         <div class="col-sm-12">
            <mat-form-field class="full-width">
               <mat-label>Description</mat-label>
               <textarea matInput formControlName="description" placeholder="Query's Purpose"></textarea>
            </mat-form-field>
            <mat-error *ngIf="registerForm.controls.description.touched && registerForm.controls.description.errors">
               <span *ngIf="registerForm.controls.description.errors.required">Description is required</span>
            </mat-error>
         </div>
      </div> -->
      <div class="row">
         <div class="col-sm-12">
            <span>Query</span>
            <ngx-codemirror formControlName="query" [options]="{
         theme: 'idea',
         mode: (this.database ? this.database.type : 'sql'),
         gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter', 'CodeMirror-lint-markers', 'CodeMirror'],
         readOnly: (!!this.database ? false : 'nocursor'),
         lineNumbers: true,
         lineWrapping: true,
         foldGutter: true,
         autoCloseBrackets: true,
         matchBrackets: true,
         lint: true,
         readOnly: detail ? 'nocursor' : false
       }"></ngx-codemirror>
            <mat-error *ngIf="registerForm.controls.query.touched && registerForm.controls.query.errors">
               <span *ngIf="registerForm.controls.query.errors.required">Query is required</span>
            </mat-error>
         </div>
      </div>
      <div class="row" *ngIf="!detail">
         <div class="col-sm-12 align-right">
            <button mat-raised-button color="primary">Submit</button>
         </div>
      </div>
   </form>
</div>